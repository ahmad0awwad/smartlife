<!DOCTYPE html>
<html lang="en">
   <head>
      <!-- basic -->
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <!-- mobile metas -->
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="viewport" content="initial-scale=1, maximum-scale=1">
      <!-- site metas -->
      <title>Eflyer</title>
      <meta name="keywords" content="">
      <meta name="description" content="">
      <meta name="author" content="">
      <!-- bootstrap css -->
      <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
      <!-- style css -->
      <link rel="stylesheet" type="text/css" href="css/style.css">
      <link rel="stylesheet" type="text/css" href="style.css">
<!-- Swiper CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css" />

      <!-- Responsive-->
      <link rel="stylesheet" href="css/responsive.css">
      <!-- fevicon -->
      <link rel="icon" href="images/fevicon.png" type="image/gif" />
      <!-- Scrollbar Custom CSS -->
      <link rel="stylesheet" href="css/jquery.mCustomScrollbar.min.css">
      <!-- Tweaks for older IEs-->
      <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
      <!-- fonts -->
      <link href="https://fonts.googleapis.com/css?family=Poppins:400,700&display=swap" rel="stylesheet">
      <!-- font awesome -->
      <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
      <!--  -->
      <!-- owl stylesheets -->
      <link href="https://fonts.googleapis.com/css?family=Great+Vibes|Poppins:400,700&display=swap&subset=latin-ext" rel="stylesheet">
      <link rel="stylesheet" href="css/owl.carousel.min.css">
      <link rel="stylesoeet" href="css/owl.theme.default.min.css">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css" media="screen">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>

      <!-- Dynamically Add Open Graph Meta Tags for 'halawkakaw' -->
   <meta property="og:title" content="HalawKakaw - Sweet Treats & More">
   <meta property="og:description" content="Imported sweets, snacks, and more with delivery across Kuwait. Discover your favorites at HalawKakaw!">
   <meta property="og:image" content="/public/images/link.jpg">
   <meta property="og:url" content="https://reachpluss.com/<%= client.url %>">
   <meta property="og:type" content="website">

   <!-- Twitter Meta Tags -->
   <meta name="twitter:card" content="summary_large_image">
   <meta name="twitter:title" content="HalawKakaw - Sweet Treats & More">
   <meta name="twitter:description" content="Imported sweets, snacks, and more with delivery across Kuwait. Discover your favorites at HalawKakaw!">
   <meta name="twitter:image" content="/public/images/link.jpg">
   <link rel="stylesheet" href="/public/stylesheets/halawa.css">
 
   <style>
      .product-card {
         background: #fff;
         border-radius: 10px;
         box-shadow: 0 2px 10px rgba(0,0,0,0.1);
         padding: 15px;
         margin-bottom: 30px;
         height: 100%;
         display: flex;
         flex-direction: column;
         justify-content: space-between;
      }
      .product-card img {
         width: 100%;
         height: 200px;
         object-fit: contain;
         margin-bottom: 10px;
      }
      .pagination {
         justify-content: center;
      }
      .sidebar {
         background: #f1f1f1;
         padding: 20px;
         border-radius: 10px;
         margin-bottom: 30px;
      }
      
    
      @media (max-width: 768px) {
  .sidebar {
    margin-bottom: 20px;
  }
  .sidebar h5, .sidebar h6 {
    font-size: 1rem;
  }
}
.product-card {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 12px;
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
  text-align: center;
  height: 100%;
}

.product-link {
  text-decoration: none;
  color: inherit;
  width: 100%;
}

.product-image-wrapper {
  width: 100%;
  height: 140px;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  margin-bottom: 10px;
}

.product-image {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
  display: block;
}

.product-name {
  font-size: 14px;
  font-weight: 500;
  min-height: 36px;
  display: block;
  margin-bottom: 4px;
}

.product-price {
  font-size: 15px;
  color: #B12704;
  font-weight: bold;
  margin-bottom: 8px;
}

@media (max-width: 576px) {
  .product-image-wrapper {
    height: 100px;
  }

  .product-name {
    font-size: 13px;
  }

  .product-price {
    font-size: 14px;
  }
}


   </style>
</head>
<body>
    <!-- banner bg main start -->
    <div class="banner_bg_main">
       <!-- header top section start -->
       <div class="container">
          <div class="header_section_top">
             <div class="row">
                <div class="col-sm-12">
                   <div class="custom_menu">
                      <ul>
                         <li><a href="#">Best Sellers</a></li>
                         <li><a href="#">Gift Ideas</a></li>
                         <li><a href="#">New Releases</a></li>
                         <li><a href="#">Today's Deals</a></li>
                         <li><a href="#">Customer Service</a></li>
                      </ul>
                   </div>
                </div>
             </div>
          </div>
       </div>
       <!-- header top section start -->
       <!-- logo section start -->
    
       <!-- logo section end -->
       <!-- header section start -->
       <div class="header_section">
         <div class="container">
            <div class="containt_main">
              
               
               <div id="mySidenav" class="sidenav">
                  <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
      
                  <a href="index.html">Home</a>
                  <a href="about.html">About Us</a>
                  <a href="contact.html">Contact</a>
                  <a href="auth.html">Sign In/Sign Up </a>
      
                  <!-- Category Links will be inserted here -->
                  <div id="categoryLinks"></div>
      
                 
      
               </div>

              
               <span class="toggle_icon" onclick="openNav()"><img src="images/toggle-icon.png"></span>
               <div class="dropdown">
                  <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">All Category 
                  </button>
                  <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                     <a class="dropdown-item" href="#">Action</a>
                     <a class="dropdown-item" href="#">Another action</a>
                     <a class="dropdown-item" href="#">Something else here</a>
                  </div>
               </div>
               <div class="main">
                  <!-- Another variation with a button -->
                  <div class="input-group" style="position: relative;">
                     <input type="text" id="searchInput" class="form-control" placeholder="Search...">
                     <div class="input-group-append">
                         <button class="btn btn-secondary" type="button" style="background-color: #f26522; border-color:#f26522">
                             <i class="fa fa-search"></i>
                         </button>
                     </div>
                 
                     <!-- Search results will appear here -->
                     <div id="searchResults" style="position:absolute; top:100%; left:0; right:0; background:white; z-index:1000; max-height:400px; overflow-y:auto; border:1px solid #ccc; border-top:none; display:none; padding:10px;">
                     </div>
                 </div>
                 



               </div>
               
               <div class="header_box">
                  <div class="lang_box ">
                     <a href="index.html" title="logo">
                        <img src="images/logolc.png" alt="Logo" class="logo_img">
                     </a>
                     <div class="dropdown-menu ">
                        <a href="#" class="dropdown-item">
                        <img src="images/flag-france.png" class="mr-2" alt="flag">
                        French
                        </a>
                     </div>
                  </div>
                  <div class="login_menu">
                     <ul>
                         <li>
                             <a href="cart.html" style="position:relative;">
                                 <i class="fa fa-shopping-cart" aria-hidden="true"></i>
                                 <span class="padding_10">Cart</span>
                                 <span id="cart-count" style="
                                 background: red; 
                                 color: white; 
                                 border-radius: 50%; 
                                 padding: 1px 6px; 
                                 font-size: 0.7rem; 
                                 position: absolute; 
                                 top: -5px; 
                                 right: -10px;
                                 line-height: 1;
                             ">0</span>
                                                             </a>
                         </li>
                         <li>
                             <a href="auth.html">
                                 <i class="fa fa-user" aria-hidden="true"></i>
                                 <span class="padding_10">Sign In</span>
                             </a>
                         </li>
                     </ul>
                 </div>
                 
               </div>
            </div>
         </div>
      </div>
      

      <div class="container mt-4">
         <div class="row">
       
           <!-- 🔹 Left Sidebar (Filters) -->
<div class="col-lg-3 col-md-4 col-12 mb-4">
   <div class="card p-3">
     <h5>Filter</h5>
 
     <label for="sortOptions">Sort by:</label>
     <select id="sortOptions" class="form-control mb-3">
       <option value="">Default</option>
       <option value="priceLowHigh">Price: Low to High</option>
       <option value="priceHighLow">Price: High to Low</option>
       <option value="nameAZ">Name: A to Z</option>
       <option value="nameZA">Name: Z to A</option>
     </select>
 
     <h6>Price Range</h6>
     <div class="d-flex mb-3">
       <input type="number" id="minPrice" class="form-control mr-2" placeholder="Min" style="width: 45%;">
       <input type="number" id="maxPrice" class="form-control" placeholder="Max" style="width: 45%;">
     </div>
   </div>
 </div>
 
       
           <!-- 🟦 Right Main Column (Products + Pagination) -->
           <div class="col-lg-9 col-md-8">
             <div class="row" id="productsContainer">
               <!-- Products will be injected here -->
             </div>
       
             <!-- Pagination -->
             <nav>
               <ul class="pagination justify-content-center mt-3" id="pagination">
                 <!-- Pagination buttons -->
               </ul>
             </nav>
           </div>
       
         </div>
       </div>
       

<!-- fashion section start -->
<!-- <div class="fashion_section">
   <div class="container">
       <div class="products-grid" id="productsContainer">
       Products will be inserted here dynamically 
       </div>
   </div>
</div> -->

<div id="productsContainer">
    <!-- Dynamically generated -->
  </div>
  
      
    <!-- Footer section start -->
 <footer class="footer_section" style="background-color: #1e3a8a; color: #ffffff; padding: 60px 0 30px 0;">
    <div class="container text-center">
 
       <!-- Logo -->
       <div class="footer_logo mb-4">
          <a href="index.html">
             <img src="images/logolc.png" alt="SmartLife Logo" style="height: 60px;">
          </a>
       </div>
 
       <!-- Subscribe box
       <div class="subscribe_box mb-5 d-flex justify-content-center">
          <input type="email" class="mail_bt" placeholder="Enter your email" name="email" style="padding: 12px 20px; border-radius: 30px 0 0 30px; border: none; max-width: 300px; width: 100%;">
          <button type="submit" style="background-color: #f26522; color: #fff; border: none; padding: 12px 25px; border-radius: 0 30px 30px 0; font-weight: bold;">Subscribe</button>
       </div> -->
 
       <!-- Footer links -->
       <div class="footer_menu mb-4">
          <ul class="list-unstyled d-flex flex-wrap justify-content-center">
             <li class="mx-3 mb-2"><a href="#" style="color: #ffffff; text-decoration: none;">Best Sellers</a></li>
             <li class="mx-3 mb-2"><a href="#" style="color: #ffffff; text-decoration: none;">Gift Ideas</a></li>
             <li class="mx-3 mb-2"><a href="#" style="color: #ffffff; text-decoration: none;">New Releases</a></li>
             <li class="mx-3 mb-2"><a href="#" style="color: #ffffff; text-decoration: none;">Today's Deals</a></li>
             <li class="mx-3 mb-2"><a href="#" style="color: #ffffff; text-decoration: none;">Customer Service</a></li>
          </ul>
       </div>
 
       
      <!-- Floating WhatsApp Button -->
      <a href="https://wa.me/180012001200" target="_blank" id="what">
 راسلنا   </a>
    
 
       
 
       <!-- Social media icons  -->
       <div class="social-icons mb-4">
          <a href="#"><img src="images/face.svg" alt="Facebook" style="width: 30px; margin: 0 10px;"></a>
          <a href="#"><img src="images/x.png" alt="Twitter" style="width: 30px; margin: 0 10px;"></a>
          <a href="#"><img src="images/insta.png" alt="Instagram" style="width: 30px; margin: 0 10px;"></a>
          <a href="#"><img src="images/y.png" alt="youtube" style="width: 30px; margin: 0 10px;"></a>
          <a href="https://wa.me/96567734568" target="_blank">
             <img src="images/wlogo.png" alt="WhatsApp" style="width: 30px; margin: 0 10px;">
         </a>
         
 
       </div>
 
    </div>
 </footer>
 <!-- Footer section end -->
 
 <!-- Copyright section start -->
 <div class="copyright_section" style="background-color: #162c5b; color: #ffffff; padding: 15px 0;">
    <div class="container text-center">
       <p class="mb-0" style="font-size: 14px;">© 2025 SmartLife. All Rights Reserved. Powered by <a href="index.html" style="color: #f26522; font-weight: bold;">SmartLife</a>.</p>
    </div>
 </div>
 <!-- Copyright section end -->
 

<!-- Scripts -->
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>
<script src="js/custom.js"></script>
<script src="js/script.js"></script>

<script>
const urlParams = new URLSearchParams(window.location.search);
const categoryName = urlParams.get('cat') || '';

let products = [];
let currentPage = 1;
const productsPerPage = 10;

async function fetchProducts() {
   try {
      const res = await fetch('http://localhost:3000/products');
      const data = await res.json();
      products = data.filter(p => p.category.toLowerCase() === categoryName.toLowerCase());
      renderProducts();
      renderPagination();
   } catch (err) {
      console.error('Error fetching products:', err);
   }
}
// Live filtering on sort and price
document.getElementById('sortOptions')?.addEventListener('change', applyFilters);
document.getElementById('minPrice')?.addEventListener('input', debounce(applyFilters, 300));
document.getElementById('maxPrice')?.addEventListener('input', debounce(applyFilters, 300));

// Debounce to reduce lag
function debounce(func, delay) {
  let timeout;
  return function (...args) {
    clearTimeout(timeout);
    timeout = setTimeout(() => func.apply(this, args), delay);
  };
}

function applyFilters() {
  const min = parseFloat(document.getElementById('minPrice').value);
  const max = parseFloat(document.getElementById('maxPrice').value);
  const sort = document.getElementById('sortOptions').value;

  let filtered = [...products];

  filtered = filtered.filter(p => {
    const price = Number(p.price);
    if (!isNaN(min) && price < min) return false;
    if (!isNaN(max) && price > max) return false;
    return true;
  });

  console.log('🎯 Filtered products:', filtered.map(p => ({ name: p.name, price: p.price })));

  filteredProducts = sortProducts(filtered, sort);
  currentPage = 1;
  renderFilteredProducts();
  renderPagination(filteredProducts);
}


function renderFilteredProducts() {
  const container = document.getElementById('productsContainer');
  container.innerHTML = '';

  const start = (currentPage - 1) * productsPerPage;
  const end = start + productsPerPage;
  const current = filteredProducts.slice(start, end);

  for (let product of current) {
    container.innerHTML += `
<div class="col-4 col-sm-3 col-md-3 mb-4">
        <div id="product-${product._id}" style="...">
          <!-- rest of your card (same as renderProducts) -->
        </div>
      </div>
    `;
  }

  const cart = JSON.parse(localStorage.getItem('cart')) || {};
  Object.keys(cart).forEach(productId => updateProductCard(productId));
}

function renderProducts() {
  const container = document.getElementById('productsContainer');
  container.innerHTML = '';

  const sortedProducts = sortProducts(products);
  const start = (currentPage - 1) * productsPerPage;
  const end = start + productsPerPage;
  const currentProducts = sortedProducts.slice(start, end);

  for (let product of currentProducts) {
    container.innerHTML += `<div class="col-4 col-sm-3 col-md-3 mb-4">
  <div id="product-${product._id}" class="product-card">
    <a href="product.html?id=${product._id}" class="product-link">
      <div class="product-image-wrapper">
        <img src="http://localhost:3000/${product.mainImageUrl}" alt="${product.name}" class="product-image">
      </div>
      <div class="product-info">
        <span class="product-name">${product.name}</span>
        <div class="product-price">$${product.price}</div>
      </div>
    </a>
    <div class="btn_main">
      <button class="btn btn-primary btn-sm w-100" onclick="addToCart('${product._id}')">
        Add to Cart
      </button>
    </div>
  </div>
</div>
 `;
  }

  // Refresh any quantity buttons
  const cart = JSON.parse(localStorage.getItem('cart')) || {};
  Object.keys(cart).forEach(productId => updateProductCard(productId));
}

function renderPagination(list = products) {
  const pages = Math.ceil(list.length / productsPerPage);
  const pagination = document.getElementById('pagination');
  pagination.innerHTML = '';

  for (let i = 1; i <= pages; i++) {
    pagination.innerHTML += `
      <li class="page-item ${i === currentPage ? 'active' : ''}">
        <a class="page-link" href="#" onclick="goToPage(${i})">${i}</a>
      </li>
    `;
  }
}

function goToPage(page) {
  currentPage = page;
  if (typeof filteredProducts !== 'undefined') {
    renderFilteredProducts();
    renderPagination(filteredProducts);
  } else {
    renderProducts();
    renderPagination();
  }
}

function sortProducts(productsArray) {
   const sort = document.getElementById('sortOptions').value;
   switch (sort) {
      case 'priceLowHigh':
         return [...productsArray].sort((a, b) => a.price - b.price);
      case 'priceHighLow':
         return [...productsArray].sort((a, b) => b.price - a.price);
      case 'nameAZ':
         return [...productsArray].sort((a, b) => a.name.localeCompare(b.name));
      case 'nameZA':
         return [...productsArray].sort((a, b) => b.name.localeCompare(a.name));
      default:
         return productsArray;
   }
}

document.getElementById('sortOptions').addEventListener('change', () => {
   renderProducts();
   renderPagination();
});

fetchProducts();
</script>

<script>
   function openNav() {
     document.getElementById("mySidenav").style.width = "250px";
   }
   
   function closeNav() {
     document.getElementById("mySidenav").style.width = "0";
   }
</script>
<script src="js/trackSource.js"></script>

</body>
</html>
